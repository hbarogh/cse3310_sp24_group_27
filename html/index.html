<!-- login.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Word Seach Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
    </style>
  </head>

  <body>
    <div style="text-align: center">
      <h1>The Word Search Game</h1>
      <hr />
    </div>

    <form id="usernameForm" style="text-align: center; padding: 10px">
      <label for="usernameInput" style="font-size: 16pt"
        >Enter a username to start:</label
      >
      <input
        type="text"
        id="usernameInput"
        placeholder="Enter your username"
        required
        style="font-size: 16pt"
      />
      <button
        type="button"
        onclick="submitUsername(event)"
        style="font-size: 16pt"
      >
        Start Game
      </button>
    </form>

    <script>
      // for test use in browser
      //this is my new code that I put in, not done/correct yet though

      //add a class that handles the json data like in tic tac toe, then I will call that when I send it over to the java side. I also need a class just like this one in the java code as well
      class UserEvent {
        Button = -1;
        PlayerIdx = 0;
        GameId = 0;
      }
      var connection = null;
      var serverUrl = "ws://" + window.location.hostname + ":9127";
      // var serverUrl = "ws://" + window.location.hostname + ":9180" + (parseInt(location.port) + 100);
      connection = new WebSocket(serverUrl);

      connection.onopen = function (evt) {
        console.log("Connection opened.");
      };

      connection.onclose = function (evt) {
        console.log("Connection closed.");
      };

      function submitUsername(event) {
        if (event) {
          event.preventDefault();
        }

        var username = document.getElementById("usernameInput").value;
        if (username.trim() !== "") {
          //put the send from tic tac toe here
          var waitingPlayersList = document.getElementById(
            "waiting-players-list"
          );
          var newPlayerItem = document.createElement("li");
          newPlayerItem.textContent = username;
          waitingPlayersList.appendChild(newPlayerItem);
          U = new UserEvent();
          connection.send(JSON.stringify(U)); // Send the username to the server
          console.log(JSON.stringify(U));
        } else {
          alert("Please enter a valid username.");
        }
      }

      document
        .getElementById("usernameForm")
        .addEventListener("submit", submitUsername);
      // Listen for messages from the server
      connection.onmessage = function (event) {
        var message = JSON.parse(event.data);
        // Assuming the server sends a message containing the username of the newly joined player
        // Modify this logic according to the actual message format from the server
        if (message.type === "new_player") {
          var playerName = message.username;
          addPlayerToList(playerName);
        }
      };
    </script>
  </body>
</html>

<!-- lobby.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lobby</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .container {
        display: flex;
        justify-content: space-between;
        padding: 10px;
      }
      .box {
        flex: 1;
        border: 1px solid #ccc;
        /*
                padding-top: 20px;
                padding-bottom: 20px;
                padding-left: 20px;
                padding-right: 20px;
                */
        padding: 20px;
        margin-right: 20px;
      }
      .chat-box {
        cursor: pointer;
        height: 300px;
        overflow-y: auto;
      }
      .player-buttons {
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <div style="text-align: center">
      <h1>The Word Search Game</h1>
      <hr />
      <h2 style="margin-bottom: 0px">Lobby</h2>
    </div>

    <div class="container">
      <!-- Generate waiting players div in this style: -->
      <div id="waiting-players" class="box waiting-players-box">
        <h2 style="margin-bottom: 0px">Players Waiting</h2>
        <hr style="margin-bottom: 20px" />
        <ol id="waiting-players-list"></ol>
      </div>

      <!-- End example div -->
      <div class="box leaderboard-box">
        <h2 style="margin-bottom: 0px">Leaderboard</h2>
        <hr style="margin-bottom: 20px" />
        <div class="container">
          <!-- Generate rank div in this style: -->
          <div id="rank">
            <h3 style="margin-top: 0px">Rank</h3>
            <ol style="list-style: none; padding: 0px">
              <li>1</li>
              <li>2</li>
              <li>3</li>
            </ol>
          </div>
          <!-- End example div -->

          <div style="padding-top: 0px; border-right: 1px solid black"></div>

          <!-- Generate nickname div in this style: -->
          <div id="nickname">
            <h3 style="margin-top: 0px">Nickname</h3>
            <ol style="list-style: none; padding: 0px">
              <li>Player 4</li>
              <li>Player 5</li>
              <li>Player 6</li>
            </ol>
          </div>
          <!-- End example div -->

          <div style="padding-top: 0px; border-right: 1px solid black"></div>

          <!-- Generate score div in this style: -->
          <div id="score">
            <h3 style="margin-top: 0px">Score</h3>
            <ol style="list-style: none; padding: 0px">
              <li>1500</li>
              <li>1100</li>
              <li>990</li>
            </ol>
          </div>
          <!-- End example div -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="box chat-box">
        <h2 style="margin-bottom: 0px">Chat</h2>
        <hr style="margin-bottom: 20px" />
        <div id="chat-messages">
          <!-- Chat messages will go here -->
          <div><strong>Player 1:</strong> Hi everyone!</div>
          <div><strong>Player 2:</strong> Hello!</div>
          <!-- Example chat messages -->
        </div>
      </div>
    </div>

    <div class="container">
      <input
        id="chat-box"
        placeholder="Send a message..."
        style="font-size: 14pt; height: 20px; width: 100%"
      />
      <button
        id="chat-button"
        onclick="sendMessage()"
        style="font-size: 14pt; margin-left: 10px; margin-right: 20px"
      >
        Send
      </button>
    </div>

    <div class="container">
      <div class="box player-buttons" style="text-align: center">
        <button onclick="selectPlayers(2)" style="font-size: 14pt">
          Play With 2 Players
        </button>
        <button onclick="selectPlayers(3)" style="font-size: 14pt">
          Play With 3 Players
        </button>
        <button onclick="selectPlayers(4)" style="font-size: 14pt">
          Play With 4 Players
        </button>
      </div>
    </div>

    <script>
      function selectPlayers(numPlayers) {
        console.log(numPlayers + " players selected.");
      }
    </script>
  </body>
</html>

<!-- game.html -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Word Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .grid {
        border: 1px solid black;
        padding: 2px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(50, 1fr);
        grid-template-rows: repeat(50, 1fr);
      }
      .cell {
          font-size: 14.5pt;
          padding: 1px;
          text-align: center;
          user-select: none;
          background-color: white;
      }
      .selected
      {
          background-color: aqua;
      }
      .used
      {
          background-color: aqua;
      }

      .container {
        display: flex;
        justify-content: space-between;
        padding: 10px;
      }
      .box {
        flex: 1;
        border: 1px solid #ccc;
        padding: 20px;
        margin-right: 20px;
      }
      .chat-box {
        height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>

  <body>
    <div style="text-align: center">
      <h1>The Word Search Game</h1>
      <hr />
    </div>

    <div class="container">
      <div id="grid" class="grid">
        <!-- 50x50 grid with one letter each -->
        <script>
          const grid = document.getElementById('grid')

          // create cells in the format <div class="cell">A</div>
          // generating random letters
          const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
          const charactersLength = characters.length;
          for (let i = 0; i < 50; i++)
          {
              for (let j = 0; j < 50; j++)
              {
                  const cell = document.createElement('div')
                  cell.classList.add('cell')
                  cell.textContent = characters.charAt(Math.floor(Math.random() * charactersLength)); // random letters
                  // cell.textContent = characters.charAt((i + j) % charactersLength); // A-Z in order
                  grid.appendChild(cell);
              }
          }
      </script>
        <!-- End of example script -->
      </div>

      <div style="padding-left: 20px">
        <div class="box scoreboard-box" style="padding: 10px">
          <h2
            style="
              margin: 0px;
              margin-left: 10px;
              margin-right: 10px;
              text-align: center;
            "
          >
            Scoreboard
          </h2>

          <div id="scoreboard">
            <!-- Repeat for other players in session -->
            <div>
              <hr style="margin-bottom: 20px" />
              <div
                class="container"
                style="padding: 5px; background-color: aqua"
              >
                <h3 style="margin: 0px">Player 1</h3>
                <h3 style="margin: 0px">1500</h3>
              </div>

              <ol style="margin: 5px">
                <li>Word1</li>
                <li>Word2</li>
                <li>Word3</li>
              </ol>
            </div>

            <div>
              <hr style="margin-bottom: 20px" />
              <div
                class="container"
                style="padding: 5px; background-color: fuchsia"
              >
                <h3 style="margin: 0px">Player 2</h3>
                <h3 style="margin: 0px">1100</h3>
              </div>

              <ol style="margin: 5px">
                <li>Word4</li>
                <li>Word5</li>
                <li>Word6</li>
              </ol>
            </div>

            <div>
              <hr style="margin-bottom: 20px" />
              <div
                class="container"
                style="padding: 5px; background-color: chartreuse"
              >
                <h3 style="margin: 0px">Player 3</h3>
                <h3 style="margin: 0px">900</h3>
              </div>

              <ol style="margin: 5px">
                <li>Word7</li>
                <li>Word8</li>
                <li>Word9</li>
              </ol>
            </div>

            <div>
              <hr style="margin-bottom: 20px" />
              <div
                class="container"
                style="padding: 5px; background-color: red"
              >
                <h3 style="margin: 0px">Player 4</h3>
                <h3 style="margin: 0px">800</h3>
              </div>

              <ol style="margin: 5px">
                <li>Word10</li>
                <li>Word11</li>
                <li>Word12</li>
              </ol>
            </div>
            <!-- End example scoreboard entry -->
          </div>
        </div>

        <div style="padding: 10px"></div>

        <div class="box chat-box" style="padding: 10px">
          <h2 style="margin: 0px; text-align: center">Chat</h2>
          <hr style="margin-bottom: 20px" />
          <div id="chat-messages" style="overflow-y: auto">
            <!-- Chat messages will go here -->
            <div><strong>Player 1:</strong> Hi everyone!</div>
            <div><strong>Player 2:</strong> Hello!</div>
            <!-- Example chat messages -->
          </div>
        </div>

        <div class="container" style="padding: 0px; padding-top: 10px">
          <input
            id="chat-box"
            placeholder="Start a message..."
            style="font-size: 14pt; height: 20px; width: 100%"
          />
          <button
            id="chat-button"
            onclick="sendMessage(event)"
            style="font-size: 14pt; margin-left: 10px; margin-right: 20px"
          >
            Send
          </button>
        </div>
      </div>
    </div>

    <script>
      function sendMessage(event) {
        if (event) {
          event.preventDefault();
        }
        var chatBox = document.getElementById("chat-box");
        var message = chatBox.value;
        var usernameInput = document.getElementById("usernameInput");
        var username = usernameInput.value.trim();
        if (message.trim() !== "") {
          var userMessage = {
            type: "chat_message",
            text: message,
            username: username,
          }; // Add your username logic as needed
          connection.send(JSON.stringify(userMessage)); // Send the chat message as JSON
          console.log(JSON.stringify(userMessage));
          chatBox.value = ""; // Clear the input field
        } else {
          alert("Please enter a valid message.");
        }
      }

      connection.onmessage = function (event) {
        var message = JSON.parse(event.data);
        if (message.type === "chat_message") {
          addChatMessage(message.text, message.username);
        } else if (message.type === "new_player") {
          var playerName = message.username;
          addPlayerToList(playerName);
        }
      };

      function addChatMessage(message, username) {
        var chatMessages = document.getElementById("chat-messages");
        var newMessage = document.createElement("div");
        newMessage.innerHTML = "<strong>" + username + ":</strong> " + message;
        chatMessages.appendChild(newMessage);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the bottom
      }

      // highlighting will not work if errors are thrown
      document.addEventListener("DOMContentLoaded", function () {
        let isMouseDown = false;
        let startCell = null;
        let endCell = null;

        // Grid dimensions
        const numRows = 50;
        const numCols = 50;

        function selectCells() {
          const cells = document.querySelectorAll(".cell");
          cells.forEach((cell, index) => {
            cell.addEventListener("mousedown", function () {
              if (!cell.classList.contains("used")) {
                isMouseDown = true;
                startCell = index;
                cell.classList.add("selected");
              }
            });

            cell.addEventListener("mouseover", function () {
              if (isMouseDown && !cell.classList.contains("used")) {
                endCell = index;
                selectRange(startCell, endCell);
              }
            });
          });

          document.addEventListener("mouseup", function () {
            let hasSelected = false;
            cells.forEach((cell) => {
              if (cell.classList.contains("selected")) {
                hasSelected = true;
              }
            });

            if (hasSelected) {
              // Submit/check logic can be implemented here
              selectedCellsToConsole(); // testing letter selection in console

              isMouseDown = false;
              startCell = null;
              endCell = null;
              cells.forEach((cell, index) => {
                cell.classList.remove("selected");
              });
            }
          });
        }

        function selectRange(start, end) {
          const cells = document.querySelectorAll(".cell");

          let startRowCol = getRowCol(start);
          let endRowCol = getRowCol(end);

          let deltaX = endRowCol[0] - startRowCol[0];
          let deltaY = endRowCol[1] - startRowCol[1];
          let m = 0;
          if (deltaX == 0) {
            m = "undef";
          } else {
            m = deltaY / deltaX;

            if (m != 0 && m != 1 && m != -1) {
              m = Math.floor(m);

              if (m < -1 || m > 1) {
                m = "undef";
              }
            }
          }
          let dist = getDist(startRowCol, endRowCol);

          cells.forEach((cell, index) => {
            let currRowCol = getRowCol(index);

            let currDeltaX = currRowCol[0] - startRowCol[0];
            let currDeltaY = currRowCol[1] - startRowCol[1];
            let currM = 0;
            if (currDeltaX == 0) {
              currM = "undef";
            } else {
              currM = currDeltaY / currDeltaX;
            }

            let currDist = getDist(startRowCol, currRowCol);

            if (!cell.classList.contains("used")) {
              if (index == start) {
                cell.classList.add("selected");
              } else if (currDist <= dist && currM == m) {
                if (
                  Math.sign(currDeltaX) == Math.sign(deltaX) &&
                  Math.sign(currDeltaY) == Math.sign(deltaY)
                ) {
                  cell.classList.add("selected");
                }
              } else {
                cell.classList.remove("selected");
              }
            }
          });
        }

        function selectedCellsToConsole() {
          const selectedCells = document.querySelectorAll(".selected");
          let selectedLetters = "";

          selectedCells.forEach((cell) => {
            selectedLetters += cell.textContent.trim();
          });

          console.log(selectedLetters);
        }

        function getRowCol(index) {
          const row = Math.floor(index / numCols);
          const col = index % numCols;
          return [row, col];
        }

        function getDist(coord1, coord2) {
          return Math.sqrt(
            Math.pow(coord2[0] - coord1[0], 2) +
              Math.pow(coord2[1] - coord1[1], 2)
          );
        }

        selectCells();
      });
    </script>
  </body>
</html>